name: "Pitest"

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  pitest-main:
    runs-on: ubuntu-latest
    steps:
      - name: Set up JDK 8
        uses: actions/setup-java@v1
        with:
          java-version: 8
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-main
        run: |
          ./.ci/pitest.sh pitest-main
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest2-main-coverage-report
          path: staging
          retention-days: 3

  pitest-javadoc:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-javadoc
        run: |
          ./.ci/pitest.sh pitest-javadoc
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest2-javadoc-coverage-report
          path: staging
          retention-days: 3

  pitest-indentation:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-indentation
        run: |
          ./.ci/pitest.sh pitest-indentation
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest2-indentation-coverage-report
          path: staging
          retention-days: 3

  pitest-xpath:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-xpath
        run: |
          ./.ci/pitest.sh pitest-xpath
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest2-xpath-coverage-report
          path: staging
          retention-days: 3

  pitest-packagenamesloader:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-packagenamesloader
        run: |
          ./.ci/pitest.sh pitest-packagenamesloader
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest5-packagenamesloader-coverage-report
          path: staging

  pitest-tree-walker:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-tree-walker
        run: |
          ./.ci/pitest.sh pitest-tree-walker
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest5-tree-walker-coverage-report
          path: staging

  pitest-naming:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-naming
        run: |
          ./.ci/pitest.sh pitest-naming
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest5-naming-coverage-report
          path: staging

  pitest-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-metrics
        run: |
          ./.ci/pitest.sh pitest-metrics
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest5-metrics-coverage-report
          path: staging

  pitest-misc:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-misc
        run: |
          ./.ci/pitest.sh pitest-misc
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest3-misc-coverage-report
          path: staging
          retention-days: 3

  pitest-design:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-Common
        run: |
          ./.ci/pitest.sh pitest-design
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest3-design-coverage-report
          path: staging
          retention-days: 3

  pitest-api:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-api
        run: |
          ./.ci/pitest.sh pitest-api
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest3-api-coverage-report
          path: staging
          retention-days: 3

  pitest-utils:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-utils
        run: |
          ./.ci/pitest.sh pitest-utils
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest3-utils-coverage-report
          path: staging
          retention-days: 3

  pitest-blocks:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-blocks
        run: |
          ./.ci/pitest.sh pitest-blocks
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest6-blocks-coverage-report
          path: staging
          retention-days: 3

  pitest-sizes:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-sizes
        run: |
          ./.ci/pitest.sh pitest-sizes
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest6-sizes-coverage-report
          path: staging
          retention-days: 3

  pitest-modifier:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-modifier
        run: |
          ./.ci/pitest.sh pitest-modifier
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest6-modifier-coverage-report
          path: staging
          retention-days: 3

  pitest-regexp:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-regexp
        run: |
          ./.ci/pitest.sh pitest-regexp
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest6-regexp-coverage-report
          path: staging
          retention-days: 3

  pitest-coding:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-Coding
        run: |
          ./.ci/pitest.sh pitest-coding
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest1-coding-coverage-report
          path: staging
          retention-days: 3

  pitest-common:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-Common
        run: |
          ./.ci/pitest.sh pitest-common
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest1-common-coverage-report
          path: staging
          retention-days: 3

  pitest-imports:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-imports
        run: |
          ./.ci/pitest.sh pitest-imports
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest1-imports-coverage-report
          path: staging
          retention-days: 3

  pitest-ant:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-ant
        run: |
          ./.ci/pitest.sh pitest-ant
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest1-ant-coverage-report
          path: staging
          retention-days: 3


  pitest-annotation:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-annotation
        run: |
          ./.ci/pitest.sh pitest-annotation
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest4-annotation-coverage-report
          path: staging
          retention-days: 3

  pitest-whitespace:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-whitespace
        run: |
          ./.ci/pitest.sh pitest-whitespace
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest4-whitespace-coverage-report
          path: staging
          retention-days: 3

  pitest-filters:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-filters
        run: |
          ./.ci/pitest.sh pitest-filters
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest4-filters-coverage-report
          path: staging
          retention-days: 3

  pitest-header:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-header
        run: |
          ./.ci/pitest.sh pitest-header
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest4-header-coverage-report
          path: staging
          retention-days: 3

  pitest-common-2:
    runs-on: ubuntu-latest
    steps:
      - name: Setup local maven cache
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: checkstyle-maven-cache-${{ hashFiles('**/pom.xml') }}
      - name: Checkout
        uses: actions/checkout@v2
      - name: pitest-common-2
        run: |
          ./.ci/pitest.sh pitest-common-2
      - name: Stage results
        if: failure()
        run: |
          mkdir staging && cp -r target/pit-reports/ staging
      - name: Archive code coverage results
        if: failure()
        uses: actions/upload-artifact@v2
        with:
          name: pitest8-common-2-coverage-report
          path: staging
          retention-days: 3
