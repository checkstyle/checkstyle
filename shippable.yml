language: java


jdk:
  - oraclejdk8

env:
  matrix:
    - PROFILE="-Ppitest-checks-blocks,no-validations"
    - PROFILE="-Ppitest-checks-coding,no-validations"
    - PROFILE="-Ppitest-checks-design,no-validations"
    - PROFILE="-Ppitest-checks-header,no-validations"
    - PROFILE="-Ppitest-checks-imports,no-validations"
    - PROFILE="-Ppitest-checks-indentation,no-validations"
    - PROFILE="-Ppitest-checks-javadoc,no-validations"
    - PROFILE="-Ppitest-checks-metrics,no-validations"
    - PROFILE="-Ppitest-checks-modifier,no-validations"
    - PROFILE="-Ppitest-checks-naming,no-validations"
    - PROFILE="-Ppitest-checks-regexp,no-validations"
    - PROFILE="-Ppitest-checks-sizes,no-validations"
    - PROFILE="-Ppitest-checks-whitespace,no-validations"

build:
  cache: true
  cache_dir_list:
    - /root/.m2

  ci:
    # we skip PRs and commits that are not for Issues, as pitest is too time consuming
    - >-
      SKIP_FILES="appveyor.yml|circle.yml|distelli-manifest.yml|.travis.yml|wercker.yml|fast-forward-merge.sh|LICENSE|LICENSE.apache20|README.md|release.sh|RIGHTS.antlr"
      SKIP_CI_BY_CONTENT=$(if [[ $(git diff --name-only HEAD HEAD~1 | grep -vE "$SKIP_FILES" | cat | wc -c) > 0 ]]; then echo false; else echo true; fi;)
      SKIP_CI_BY_MESSAGE=$(if [[ (git log -1 | grep -E "Issue \#[0-9]+\:" | cat | wc -l) > 0 ]]; then echo false; else echo true; fi;)
      echo "SKIP_CI_BY_CONTENT="$SKIP_CI_BY_CONTENT
      echo "SKIP_CI_BY_MESSAGE="$SKIP_CI_BY_MESSAGE
      if [[ $SKIP_CI_BY_CONTENT == 'false' && $SKIP_CI_BY_MESSAGE == 'false' ]];
      then
        mvn $PROFILE clean verify org.pitest:pitest-maven:mutationCoverage;
      fi
